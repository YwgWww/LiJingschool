<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>信息学奥赛学生学习追踪表</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3498db;
            position: relative;
        }
        
        .export-controls {
            position: absolute;
            right: 0;
            top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .export-btn:hover {
            background-color: #8e44ad;
        }
        
        .export-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .export-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1001;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .export-dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .export-dropdown-content a:hover {
            background-color: #f5f5f5;
        }
        
        .export-dropdown:hover .export-dropdown-content {
            display: block;
        }
        
        .export-dropdown:hover .export-btn {
            background-color: #8e44ad;
        }
        
        .export-progress {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }
        
        .export-progress-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            color: #333;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .progress-bar-container {
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background-color: #2ecc71;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        .card-title i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #3498db;
            color: white;
            text-align: left;
            padding: 12px 15px;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .weakness-tag {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .difficulty-tag {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .progress-container {
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 6px;
            margin: 5px 0 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #2ecc71;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .difficulty-low { background-color: #2ecc71; }
        .difficulty-medium { background-color: #f39c12; }
        .difficulty-high { background-color: #e74c3c; }
        
        .rating {
            color: #f1c40f;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-add {
            background-color: #2ecc71;
            margin-top: 15px;
        }
        
        .btn-add:hover {
            background-color: #27ae60;
        }
        
        .btn-edit {
            background-color: #f39c12;
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        .btn-edit:hover {
            background-color: #e67e22;
        }
        
        .btn-save {
            background-color: #2ecc71;
        }
        
        .btn-save:hover {
            background-color: #27ae60;
        }
        
        .btn-cancel {
            background-color: #95a5a6;
        }
        
        .btn-cancel:hover {
            background-color: #7f8c8d;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .focus-list {
            list-style-type: none;
            margin-top: 15px;
            padding-left: 0;
        }
        
        .focus-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .focus-list li:hover {
            background-color: #eef5ff;
        }
        
        .focus-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            margin-right: 10px;
        }
        
        .edit-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 60px;
            resize: vertical;
            font-family: inherit;
        }
        
        .recommendation-actions {
            display: flex;
            gap: 5px;
        }
        
        .status-select {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }
        
        .editing {
            background-color: #fffde7;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .focus-actions, .recommendation-actions {
                flex-direction: column;
            }
            
            .export-controls {
                position: relative;
                top: 0;
                justify-content: center;
                margin-top: 15px;
            }
            
            header {
                padding-bottom: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>信息学奥赛学生学习追踪表</h1>
            <p class="subtitle">记录学习轨迹 · 分析弱项难项 · 优化练习策略 · 提升竞赛水平</p>
            
            <div class="export-controls">
                <div class="export-dropdown">
                    <button class="export-btn"><i class="fas fa-download"></i> 导出学习报告</button>
                    <div class="export-dropdown-content">
                        <a href="#" id="export-pdf"><i class="fas fa-file-pdf"></i> 导出为 PDF</a>
                        <a href="#" id="export-png"><i class="fas fa-file-image"></i> 导出为 PNG</a>
                        <a href="#" id="export-jpg"><i class="fas fa-file-image"></i> 导出为 JPG</a>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> 学习概览</h2>
                <div class="progress-container">
                    <div class="progress-bar" id="overall-progress" style="width: 65%"></div>
                </div>
                <p>总体进度：<span id="progress-text">65%</span></p>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">已解决题目</div>
                        <div class="stat-value" id="solved-count">42</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">平均难度</div>
                        <div class="stat-value" id="avg-difficulty">3.8</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">弱项数量</div>
                        <div class="stat-value" id="weakness-count">7</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <div><i class="fas fa-lightbulb"></i> 本周重点</div>
                    <button class="btn btn-edit" id="edit-focus-btn"><i class="fas fa-edit"></i> 编辑</button>
                </div>
                <p>根据你的学习记录，建议本周专注于：</p>
                <ul class="focus-list" id="focus-list">
                    <!-- 本周重点列表由JS动态生成 -->
                </ul>
                
                <div style="margin-top: 20px;">
                    <p><strong>推荐练习平台：</strong></p>
                    <div>
                        <span class="tag" style="background-color:#e3f2fd; color:#1565c0;">Codeforces</span>
                        <span class="tag" style="background-color:#e8f5e9; color:#2e7d32;">洛谷</span>
                        <span class="tag" style="background-color:#fff3e0; color:#f57c00;">AtCoder</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> 弱项与难项分析</h2>
            <div class="card">
                <p>识别你的知识薄弱点，集中攻克难点</p>
                <button class="btn btn-add" id="add-weakness-btn"><i class="fas fa-plus"></i> 添加弱项/难项</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>分类</th>
                            <th>具体内容</th>
                            <th>难度等级</th>
                            <th>掌握程度</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="weakness-table">
                        <!-- 数据由JS动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2 class="card-title"><i class="fas fa-tasks"></i> 做题记录与思路评价</h2>
            <div class="card">
                <p>记录每道题的解题过程、思路与反思</p>
                <button class="btn btn-add" id="add-record-btn"><i class="fas fa-plus"></i> 添加做题记录</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>题目名称</th>
                            <th>分类</th>
                            <th>日期</th>
                            <th>用时</th>
                            <th>自我评价</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="record-table">
                        <!-- 数据由JS动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="section">
            <div class="card-title">
                <div><i class="fas fa-list-alt"></i> 针对性练习建议</div>
                <button class="btn btn-edit" id="add-recommendation-btn"><i class="fas fa-plus"></i> 添加建议</button>
            </div>
            <div class="card">
                <p>根据你的弱项和做题记录生成的个性化练习建议</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>弱项分类</th>
                            <th>推荐练习题目</th>
                            <th>难度</th>
                            <th>建议完成时间</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recommendation-table">
                        <!-- 数据由JS动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 添加弱项/难项模态框 -->
        <div id="weakness-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>添加弱项/难项</h2>
                    <span class="close" id="close-weakness">&times;</span>
                </div>
                <form id="weakness-form">
                    <div class="form-group">
                        <label for="weakness-category">分类</label>
                        <select id="weakness-category" required>
                            <option value="">请选择分类</option>
                            <option value="数据结构">数据结构</option>
                            <option value="动态规划">动态规划</option>
                            <option value="图论">图论</option>
                            <option value="数学">数学</option>
                            <option value="搜索">搜索</option>
                            <option value="贪心">贪心</option>
                            <option value="字符串">字符串</option>
                            <option value="计算几何">计算几何</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weakness-content">具体内容</label>
                        <input type="text" id="weakness-content" placeholder="例如：线段树区间更新、01背包变体" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="weakness-difficulty">难度等级</label>
                        <select id="weakness-difficulty" required>
                            <option value="1">1 - 基础</option>
                            <option value="2">2 - 简单</option>
                            <option value="3" selected>3 - 中等</option>
                            <option value="4">4 - 较难</option>
                            <option value="5">5 - 困难</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weakness-mastery">掌握程度 (%)</label>
                        <input type="range" id="weakness-mastery" min="0" max="100" value="30" required>
                        <div style="display: flex; justify-content: space-between;">
                            <span>0%</span>
                            <span id="mastery-value">30%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="weakness-notes">备注/具体问题</label>
                        <textarea id="weakness-notes" placeholder="描述具体遇到的困难..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn">保存弱项记录</button>
                </form>
            </div>
        </div>
        
        <!-- 添加做题记录模态框 -->
        <div id="record-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>添加做题记录</h2>
                    <span class="close" id="close-record">&times;</span>
                </div>
                <form id="record-form">
                    <div class="form-group">
                        <label for="record-title">题目名称</label>
                        <input type="text" id="record-title" placeholder="例如：P1001 A+B Problem" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-category">题目分类</label>
                        <select id="record-category" required>
                            <option value="">请选择分类</option>
                            <option value="数据结构">数据结构</option>
                            <option value="动态规划">动态规划</option>
                            <option value="图论">图论</option>
                            <option value="数学">数学</option>
                            <option value="搜索">搜索</option>
                            <option value="贪心">贪心</option>
                            <option value="字符串">字符串</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-date">解题日期</label>
                        <input type="date" id="record-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-time">解题用时 (分钟)</label>
                        <input type="number" id="record-time" min="1" max="300" placeholder="例如：45" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-difficulty">题目难度 (1-5)</label>
                        <select id="record-difficulty" required>
                            <option value="1">1 - 非常容易</option>
                            <option value="2">2 - 容易</option>
                            <option value="3" selected>3 - 中等</option>
                            <option value="4">4 - 困难</option>
                            <option value="5">5 - 非常困难</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-rating">自我评价 (1-5星)</label>
                        <select id="record-rating" required>
                            <option value="1">★ - 需要看题解，不理解</option>
                            <option value="2">★★ - 部分理解，不能独立完成</option>
                            <option value="3">★★★ - 基本掌握，但不够熟练</option>
                            <option value="4" selected>★★★★ - 掌握较好，能独立完成</option>
                            <option value="5">★★★★★ - 完全掌握，能举一反三</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="record-notes">思路与反思</label>
                        <textarea id="record-notes" placeholder="记录解题思路、关键点、错误原因、改进方法等..." rows="4"></textarea>
                    </div>
                    
                    <button type="submit" class="btn">保存做题记录</button>
                </form>
            </div>
        </div>
        
        <!-- 添加练习建议模态框 -->
        <div id="recommendation-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>添加练习建议</h2>
                    <span class="close" id="close-recommendation">&times;</span>
                </div>
                <form id="recommendation-form">
                    <div class="form-group">
                        <label for="recommendation-weakness">弱项分类</label>
                        <input type="text" id="recommendation-weakness" placeholder="例如：动态规划-状态压缩" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendation-problems">推荐练习题目</label>
                        <textarea id="recommendation-problems" placeholder="例如：POJ 2411, HDU 1074" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendation-difficulty">难度</label>
                        <select id="recommendation-difficulty" required>
                            <option value="简单">简单</option>
                            <option value="中等" selected>中等</option>
                            <option value="困难">困难</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendation-time">建议完成时间</label>
                        <input type="text" id="recommendation-time" placeholder="例如：2周内" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendation-status">初始状态</label>
                        <select id="recommendation-status" required>
                            <option value="未开始">未开始</option>
                            <option value="进行中">进行中</option>
                            <option value="已完成">已完成</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendation-notes">补充说明</label>
                        <textarea id="recommendation-notes" placeholder="可选的额外说明..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn">保存练习建议</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 导出进度模态框 - 移到body的最外层，确保不会被截图 -->
    <div class="export-progress" id="export-progress">
        <div class="export-progress-content">
            <h3><i class="fas fa-spinner fa-spin"></i> 正在生成报告...</h3>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="export-progress-bar"></div>
            </div>
            <p id="export-progress-text">准备导出数据...</p>
            <button class="btn btn-cancel" id="cancel-export">取消</button>
        </div>
    </div>

    <script>
        // 初始化数据
        let weaknesses = [
            { id: 1, category: "动态规划", content: "状态压缩DP", difficulty: 4, mastery: 30 },
            { id: 2, category: "图论", content: "网络流最大流", difficulty: 5, mastery: 20 },
            { id: 3, category: "数据结构", content: "可持久化线段树", difficulty: 4, mastery: 40 },
            { id: 4, category: "数学", content: "莫比乌斯反演", difficulty: 5, mastery: 25 },
            { id: 5, category: "字符串", content: "后缀自动机", difficulty: 5, mastery: 15 }
        ];
        
        let records = [
            { id: 1, title: "CF 1399D - Binary String", category: "贪心", date: "2023-10-15", time: 45, difficulty: 3, rating: 4 },
            { id: 2, title: "P3372 线段树模板", category: "数据结构", date: "2023-10-12", time: 30, difficulty: 2, rating: 5 },
            { id: 3, title: "P1048 采药", category: "动态规划", date: "2023-10-10", time: 25, difficulty: 2, rating: 5 },
            { id: 4, title: "ABC 186E - Throne", category: "数学", date: "2023-10-08", time: 60, difficulty: 4, rating: 3 },
            { id: 5, title: "P4779 单源最短路径", category: "图论", date: "2023-10-05", time: 40, difficulty: 3, rating: 4 }
        ];
        
        let weeklyFocus = [
            { id: 1, content: "动态规划 - 背包问题变体" },
            { id: 2, content: "图论 - 最短路径算法优化" },
            { id: 3, content: "数据结构 - 线段树高级应用" },
            { id: 4, content: "字符串 - KMP与AC自动机" }
        ];
        
        let recommendations = [
            { id: 1, weakness: "状态压缩DP", problems: "POJ 2411, HDU 1074", difficulty: "中等", time: "2周内", status: "未开始" },
            { id: 2, weakness: "网络流最大流", problems: "P3376, POJ 1273", difficulty: "困难", time: "3周内", status: "进行中" },
            { id: 3, weakness: "可持久化线段树", problems: "P3834, P3919", difficulty: "中等", time: "2周内", status: "未开始" },
            { id: 4, weakness: "莫比乌斯反演", problems: "P2257, P3327", difficulty: "困难", time: "3周内", status: "未开始" },
            { id: 5, weakness: "后缀自动机", problems: "P3804, SPOJ LCS", difficulty: "困难", time: "4周内", status: "未开始" }
        ];
        
        // 编辑状态
        let editingFocusId = null;
        let editingRecommendationId = null;
        let isExporting = false;
        
        // DOM元素
        const weaknessTable = document.getElementById('weakness-table');
        const recordTable = document.getElementById('record-table');
        const recommendationTable = document.getElementById('recommendation-table');
        const focusList = document.getElementById('focus-list');
        const addWeaknessBtn = document.getElementById('add-weakness-btn');
        const addRecordBtn = document.getElementById('add-record-btn');
        const addRecommendationBtn = document.getElementById('add-recommendation-btn');
        const editFocusBtn = document.getElementById('edit-focus-btn');
        const weaknessModal = document.getElementById('weakness-modal');
        const recordModal = document.getElementById('record-modal');
        const recommendationModal = document.getElementById('recommendation-modal');
        const exportProgress = document.getElementById('export-progress');
        const exportProgressBar = document.getElementById('export-progress-bar');
        const exportProgressText = document.getElementById('export-progress-text');
        const cancelExportBtn = document.getElementById('cancel-export');
        const closeWeakness = document.getElementById('close-weakness');
        const closeRecord = document.getElementById('close-record');
        const closeRecommendation = document.getElementById('close-recommendation');
        const weaknessForm = document.getElementById('weakness-form');
        const recordForm = document.getElementById('record-form');
        const recommendationForm = document.getElementById('recommendation-form');
        const masterySlider = document.getElementById('weakness-mastery');
        const masteryValue = document.getElementById('mastery-value');
        const exportPdfBtn = document.getElementById('export-pdf');
        const exportPngBtn = document.getElementById('export-png');
        const exportJpgBtn = document.getElementById('export-jpg');
        
        // 初始化表格数据
        function renderTables() {
            // 渲染弱项表格
            weaknessTable.innerHTML = '';
            weaknesses.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="tag weakness-tag">${item.category}</span></td>
                    <td>${item.content}</td>
                    <td>${'★'.repeat(item.difficulty)}</td>
                    <td>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${item.mastery}%"></div>
                        </div>
                        ${item.mastery}%
                    </td>
                    <td><button class="btn btn-delete" onclick="deleteWeakness(${item.id})"><i class="fas fa-trash"></i> 删除</button></td>
                `;
                weaknessTable.appendChild(row);
            });
            
            // 渲染做题记录表格
            recordTable.innerHTML = '';
            records.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.title}</td>
                    <td><span class="tag difficulty-tag">${item.category}</span></td>
                    <td>${item.date}</td>
                    <td>${item.time}分钟</td>
                    <td>
                        <div class="rating">${'★'.repeat(item.rating)}${'☆'.repeat(5-item.rating)}</div>
                        <div style="font-size:0.8rem; color:#7f8c8d;">难度: ${'★'.repeat(item.difficulty)}</div>
                    </td>
                    <td><button class="btn btn-delete" onclick="deleteRecord(${item.id})"><i class="fas fa-trash"></i> 删除</button></td>
                `;
                recordTable.appendChild(row);
            });
            
            // 渲染本周重点列表
            renderFocusList();
            
            // 渲染推荐练习表格
            renderRecommendationTable();
            
            // 更新统计数据
            updateStats();
        }
        
        // 渲染本周重点列表
        function renderFocusList() {
            focusList.innerHTML = '';
            weeklyFocus.forEach(item => {
                const li = document.createElement('li');
                li.id = `focus-item-${item.id}`;
                
                if (editingFocusId === item.id) {
                    li.className = 'editing';
                    li.innerHTML = `
                        <div style="flex-grow: 1;">
                            <input type="text" class="edit-input" id="edit-focus-input-${item.id}" value="${item.content}">
                        </div>
                        <div class="focus-actions">
                            <button class="btn btn-save" onclick="saveFocus(${item.id})"><i class="fas fa-check"></i> 保存</button>
                            <button class="btn btn-cancel" onclick="cancelEditFocus()"><i class="fas fa-times"></i> 取消</button>
                        </div>
                    `;
                } else {
                    li.innerHTML = `
                        <div style="flex-grow: 1;">${item.content}</div>
                        <div class="focus-actions">
                            <button class="btn btn-edit" onclick="editFocus(${item.id})"><i class="fas fa-edit"></i> 编辑</button>
                            <button class="btn btn-delete" onclick="deleteFocus(${item.id})"><i class="fas fa-trash"></i> 删除</button>
                        </div>
                    `;
                }
                focusList.appendChild(li);
            });
            
            // 如果没有本周重点，显示提示信息
            if (weeklyFocus.length === 0) {
                const li = document.createElement('li');
                li.innerHTML = '<div style="flex-grow: 1; color: #7f8c8d; font-style: italic;">暂无本周重点，点击编辑按钮添加</div>';
                focusList.appendChild(li);
            }
        }
        
        // 渲染推荐练习表格
        function renderRecommendationTable() {
            recommendationTable.innerHTML = '';
            recommendations.forEach(item => {
                const row = document.createElement('tr');
                row.id = `recommendation-row-${item.id}`;
                
                if (editingRecommendationId === item.id) {
                    row.className = 'editing';
                    row.innerHTML = `
                        <td><input type="text" class="edit-input" id="edit-recommendation-weakness-${item.id}" value="${item.weakness}"></td>
                        <td><textarea class="edit-textarea" id="edit-recommendation-problems-${item.id}">${item.problems}</textarea></td>
                        <td>
                            <select class="status-select" id="edit-recommendation-difficulty-${item.id}">
                                <option value="简单" ${item.difficulty === '简单' ? 'selected' : ''}>简单</option>
                                <option value="中等" ${item.difficulty === '中等' ? 'selected' : ''}>中等</option>
                                <option value="困难" ${item.difficulty === '困难' ? 'selected' : ''}>困难</option>
                            </select>
                        </td>
                        <td><input type="text" class="edit-input" id="edit-recommendation-time-${item.id}" value="${item.time}"></td>
                        <td>
                            <select class="status-select" id="edit-recommendation-status-${item.id}">
                                <option value="未开始" ${item.status === '未开始' ? 'selected' : ''}>未开始</option>
                                <option value="进行中" ${item.status === '进行中' ? 'selected' : ''}>进行中</option>
                                <option value="已完成" ${item.status === '已完成' ? 'selected' : ''}>已完成</option>
                            </select>
                        </td>
                        <td>
                            <div class="recommendation-actions">
                                <button class="btn btn-save" onclick="saveRecommendation(${item.id})"><i class="fas fa-check"></i> 保存</button>
                                <button class="btn btn-cancel" onclick="cancelEditRecommendation()"><i class="fas fa-times"></i> 取消</button>
                            </div>
                        </td>
                    `;
                } else {
                    let statusClass = '';
                    if (item.status === '已完成') statusClass = 'difficulty-low';
                    else if (item.status === '进行中') statusClass = 'difficulty-medium';
                    else statusClass = 'difficulty-high';
                    
                    row.innerHTML = `
                        <td>${item.weakness}</td>
                        <td>${item.problems}</td>
                        <td><span class="tag ${statusClass}">${item.difficulty}</span></td>
                        <td>${item.time}</td>
                        <td><span class="tag ${statusClass}">${item.status}</span></td>
                        <td>
                            <div class="recommendation-actions">
                                <button class="btn btn-edit" onclick="editRecommendation(${item.id})"><i class="fas fa-edit"></i> 编辑</button>
                                <button class="btn btn-delete" onclick="deleteRecommendation(${item.id})"><i class="fas fa-trash"></i> 删除</button>
                            </div>
                        </td>
                    `;
                }
                recommendationTable.appendChild(row);
            });
            
            // 如果没有推荐练习，显示提示信息
            if (recommendations.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; color: #7f8c8d; font-style: italic; padding: 30px;">
                        暂无练习建议，点击添加建议按钮或添加弱项后会自动生成
                    </td>
                `;
                recommendationTable.appendChild(row);
            }
        }
        
        // 更新统计数据
        function updateStats() {
            document.getElementById('solved-count').textContent = records.length;
            
            // 计算平均难度
            const totalDifficulty = records.reduce((sum, item) => sum + item.difficulty, 0);
            const avgDifficulty = records.length > 0 ? (totalDifficulty / records.length).toFixed(1) : "0.0";
            document.getElementById('avg-difficulty').textContent = avgDifficulty;
            
            document.getElementById('weakness-count').textContent = weaknesses.length;
            
            // 更新总体进度
            const totalMastery = weaknesses.reduce((sum, item) => sum + item.mastery, 0);
            const avgMastery = weaknesses.length > 0 ? Math.round(totalMastery / weaknesses.length) : 0;
            document.getElementById('overall-progress').style.width = avgMastery + '%';
            document.getElementById('progress-text').textContent = avgMastery + '%';
        }
        
        // 导出功能
        function updateExportProgress(progress, text) {
            exportProgressBar.style.width = progress + '%';
            exportProgressText.textContent = text;
        }
        
        function startExport() {
            isExporting = true;
            exportProgress.style.display = 'flex';
            updateExportProgress(10, '准备导出数据...');
        }
        
        function finishExport() {
            isExporting = false;
            exportProgress.style.display = 'none';
            updateExportProgress(0, '准备导出数据...');
        }
        
        function cancelExport() {
            if (isExporting) {
                isExporting = false;
                exportProgress.style.display = 'none';
                updateExportProgress(0, '准备导出数据...');
            }
        }
        
        // 导出为PDF
        async function exportToPDF() {
            startExport();
            updateExportProgress(30, '正在生成PDF...');
            
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // 添加标题
                pdf.setFontSize(20);
                pdf.setTextColor(44, 62, 80);
                pdf.text('信息学奥赛学生学习追踪表', pageWidth / 2, 20, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(127, 140, 141);
                pdf.text('记录学习轨迹 · 分析弱项难项 · 优化练习策略 · 提升竞赛水平', pageWidth / 2, 28, { align: 'center' });
                
                // 添加日期
                const today = new Date();
                const dateStr = `${today.getFullYear()}年${today.getMonth()+1}月${today.getDate()}日`;
                pdf.setFontSize(10);
                pdf.setTextColor(100, 100, 100);
                pdf.text(`生成日期: ${dateStr}`, pageWidth - 20, 35, { align: 'right' });
                
                let yPos = 45;
                
                // 学习概览
                pdf.setFontSize(16);
                pdf.setTextColor(44, 62, 80);
                pdf.text('学习概览', 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(12);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`总体进度: ${document.getElementById('progress-text').textContent}`, 20, yPos);
                yPos += 7;
                pdf.text(`已解决题目: ${document.getElementById('solved-count').textContent}题`, 20, yPos);
                yPos += 7;
                pdf.text(`平均难度: ${document.getElementById('avg-difficulty').textContent}`, 20, yPos);
                yPos += 7;
                pdf.text(`弱项数量: ${document.getElementById('weakness-count').textContent}个`, 20, yPos);
                yPos += 15;
                
                // 本周重点
                if (weeklyFocus.length > 0) {
                    pdf.setFontSize(16);
                    pdf.setTextColor(44, 62, 80);
                    pdf.text('本周重点', 20, yPos);
                    yPos += 10;
                    
                    pdf.setFontSize(12);
                    pdf.setTextColor(0, 0, 0);
                    
                    weeklyFocus.forEach(focus => {
                        if (yPos > pageHeight - 20) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        
                        pdf.text(`• ${focus.content}`, 25, yPos);
                        yPos += 7;
                    });
                    
                    yPos += 10;
                }
                
                updateExportProgress(50, '正在添加弱项分析...');
                
                // 弱项与难项分析
                if (weaknesses.length > 0) {
                    if (yPos > pageHeight - 40) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(44, 62, 80);
                    pdf.text('弱项与难项分析', 20, yPos);
                    yPos += 10;
                    
                    pdf.setFontSize(10);
                    
                    // 表头
                    pdf.setFillColor(52, 152, 219);
                    pdf.setTextColor(255, 255, 255);
                    pdf.rect(20, yPos, pageWidth - 40, 8, 'F');
                    pdf.text('分类', 22, yPos + 6);
                    pdf.text('具体内容', 50, yPos + 6);
                    pdf.text('掌握程度', pageWidth - 40, yPos + 6, { align: 'right' });
                    
                    yPos += 10;
                    
                    pdf.setTextColor(0, 0, 0);
                    
                    weaknesses.forEach(weakness => {
                        if (yPos > pageHeight - 20) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        
                        pdf.text(weakness.category, 22, yPos + 6);
                        pdf.text(weakness.content, 50, yPos + 6);
                        pdf.text(`${weakness.mastery}%`, pageWidth - 22, yPos + 6, { align: 'right' });
                        
                        // 进度条
                        const progressWidth = (weakness.mastery / 100) * 30;
                        pdf.setDrawColor(200, 200, 200);
                        pdf.rect(pageWidth - 60, yPos + 2, 30, 4);
                        pdf.setFillColor(46, 204, 113);
                        pdf.rect(pageWidth - 60, yPos + 2, progressWidth, 4, 'F');
                        
                        yPos += 10;
                    });
                    
                    yPos += 10;
                }
                
                updateExportProgress(70, '正在添加练习建议...');
                
                // 针对性练习建议
                if (recommendations.length > 0) {
                    if (yPos > pageHeight - 40) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(44, 62, 80);
                    pdf.text('针对性练习建议', 20, yPos);
                    yPos += 10;
                    
                    pdf.setFontSize(10);
                    
                    // 表头
                    pdf.setFillColor(52, 152, 219);
                    pdf.setTextColor(255, 255, 255);
                    pdf.rect(20, yPos, pageWidth - 40, 8, 'F');
                    pdf.text('弱项分类', 22, yPos + 6);
                    pdf.text('推荐练习题目', 60, yPos + 6);
                    pdf.text('状态', pageWidth - 30, yPos + 6, { align: 'right' });
                    
                    yPos += 10;
                    
                    pdf.setTextColor(0, 0, 0);
                    
                    recommendations.forEach(rec => {
                        if (yPos > pageHeight - 20) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        
                        pdf.text(rec.weakness, 22, yPos + 6);
                        
                        // 处理长题目名称
                        const problems = rec.problems;
                        if (problems.length > 30) {
                            pdf.text(problems.substring(0, 30) + '...', 60, yPos + 6);
                        } else {
                            pdf.text(problems, 60, yPos + 6);
                        }
                        
                        pdf.text(rec.status, pageWidth - 22, yPos + 6, { align: 'right' });
                        
                        yPos += 10;
                    });
                }
                
                updateExportProgress(90, '正在生成PDF文件...');
                
                // 保存PDF
                const fileName = `信息学奥赛学习报告_${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2, '0')}${today.getDate().toString().padStart(2, '0')}.pdf`;
                pdf.save(fileName);
                
                updateExportProgress(100, '导出完成！');
                setTimeout(finishExport, 500);
            } catch (error) {
                console.error('导出PDF失败:', error);
                alert('导出PDF时发生错误: ' + error.message);
                finishExport();
            }
        }
        
        // 导出为图片 - 修复版，确保不包含加载框
        async function exportToImage(format) {
            startExport();
            updateExportProgress(20, '正在准备页面截图...');
            
            try {
                // 第一步：隐藏所有操作按钮和编辑元素
                const exportButtons = document.querySelectorAll('.export-controls, .btn, .focus-actions, .recommendation-actions');
                const originalDisplay = [];
                
                exportButtons.forEach(btn => {
                    originalDisplay.push({
                        element: btn,
                        display: btn.style.display
                    });
                    btn.style.display = 'none';
                });
                
                // 第二步：确保导出进度框在截图前隐藏
                const progressWasVisible = exportProgress.style.display === 'flex';
                exportProgress.style.display = 'none';
                
                updateExportProgress(50, '正在生成截图...');
                
                // 第三步：给浏览器一点时间更新DOM
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // 第四步：使用html2canvas截图
                const element = document.querySelector('.container');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#f5f7fa',
                    logging: false
                });
                
                updateExportProgress(80, '正在生成图像文件...');
                
                // 第五步：恢复所有隐藏的元素
                originalDisplay.forEach(item => {
                    if (item.element && item.element.style) {
                        item.element.style.display = item.display;
                    }
                });
                
                // 第六步：恢复进度框的显示状态
                if (progressWasVisible) {
                    exportProgress.style.display = 'flex';
                }
                
                // 创建下载链接
                const today = new Date();
                const dateStr = `${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2, '0')}${today.getDate().toString().padStart(2, '0')}`;
                const fileName = `信息学奥赛学习报告_${dateStr}.${format}`;
                
                const link = document.createElement('a');
                link.download = fileName;
                
                if (format === 'png') {
                    link.href = canvas.toDataURL('image/png');
                } else if (format === 'jpg') {
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                }
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateExportProgress(100, '导出完成！');
                setTimeout(finishExport, 500);
            } catch (error) {
                console.error(`导出${format.toUpperCase()}失败:`, error);
                alert(`导出${format.toUpperCase()}时发生错误: ` + error.message);
                finishExport();
            }
        }
        
        // 添加弱项
        function addWeakness(category, content, difficulty, mastery, notes) {
            const newId = weaknesses.length > 0 ? Math.max(...weaknesses.map(w => w.id)) + 1 : 1;
            weaknesses.push({
                id: newId,
                category,
                content,
                difficulty: parseInt(difficulty),
                mastery: parseInt(mastery)
            });
            
            // 自动生成对应的练习建议
            const difficultyText = difficulty >= 4 ? '困难' : (difficulty >= 3 ? '中等' : '简单');
            const time = difficulty >= 4 ? '3周内' : (difficulty >= 3 ? '2周内' : '1周内');
            
            const recId = recommendations.length > 0 ? Math.max(...recommendations.map(r => r.id)) + 1 : 1;
            recommendations.push({
                id: recId,
                weakness: content,
                problems: getRecommendedProblems(category),
                difficulty: difficultyText,
                time: time,
                status: "未开始"
            });
            
            renderTables();
        }
        
        // 根据分类获取推荐题目
        function getRecommendedProblems(category) {
            const problemMap = {
                "数据结构": "P3372, P3368, P3834",
                "动态规划": "P1048, P1060, P1040",
                "图论": "P3371, P4779, P3381",
                "数学": "P3811, P3868, P4549",
                "搜索": "P1120, P1379, P1433",
                "贪心": "P1090, P1803, P1223",
                "字符串": "P3375, P3808, P3796",
                "计算几何": "P1355, P1663, P2742"
            };
            
            return problemMap[category] || "P1001, P1002, P1003";
        }
        
        // 添加做题记录
        function addRecord(title, category, date, time, difficulty, rating, notes) {
            const newId = records.length > 0 ? Math.max(...records.map(r => r.id)) + 1 : 1;
            records.push({
                id: newId,
                title,
                category,
                date,
                time: parseInt(time),
                difficulty: parseInt(difficulty),
                rating: parseInt(rating)
            });
            renderTables();
        }
        
        // 添加本周重点
        function addFocus(content) {
            const newId = weeklyFocus.length > 0 ? Math.max(...weeklyFocus.map(f => f.id)) + 1 : 1;
            weeklyFocus.push({
                id: newId,
                content
            });
            renderFocusList();
        }
        
        // 编辑本周重点
        function editFocus(id) {
            editingFocusId = id;
            renderFocusList();
            
            // 聚焦到输入框
            setTimeout(() => {
                const input = document.getElementById(`edit-focus-input-${id}`);
                if (input) input.focus();
            }, 10);
        }
        
        // 保存本周重点编辑
        function saveFocus(id) {
            const input = document.getElementById(`edit-focus-input-${id}`);
            if (input && input.value.trim()) {
                const index = weeklyFocus.findIndex(f => f.id === id);
                if (index !== -1) {
                    weeklyFocus[index].content = input.value.trim();
                }
            }
            editingFocusId = null;
            renderFocusList();
        }
        
        // 取消编辑本周重点
        function cancelEditFocus() {
            editingFocusId = null;
            renderFocusList();
        }
        
        // 删除本周重点
        function deleteFocus(id) {
            if (confirm("确定要删除这个本周重点吗？")) {
                weeklyFocus = weeklyFocus.filter(f => f.id !== id);
                renderFocusList();
            }
        }
        
        // 添加练习建议
        function addRecommendation(weakness, problems, difficulty, time, status, notes) {
            const newId = recommendations.length > 0 ? Math.max(...recommendations.map(r => r.id)) + 1 : 1;
            recommendations.push({
                id: newId,
                weakness,
                problems,
                difficulty,
                time,
                status
            });
            renderRecommendationTable();
        }
        
        // 编辑练习建议
        function editRecommendation(id) {
            editingRecommendationId = id;
            renderRecommendationTable();
            
            // 聚焦到第一个输入框
            setTimeout(() => {
                const input = document.getElementById(`edit-recommendation-weakness-${id}`);
                if (input) input.focus();
            }, 10);
        }
        
        // 保存练习建议编辑 - 修复bug
        function saveRecommendation(id) {
            const weakness = document.getElementById(`edit-recommendation-weakness-${id}`).value;
            const problems = document.getElementById(`edit-recommendation-problems-${id}`).value;
            const difficulty = document.getElementById(`edit-recommendation-difficulty-${id}`).value;
            const time = document.getElementById(`edit-recommendation-time-${id}`).value;
            const status = document.getElementById(`edit-recommendation-status-${id}`).value;
            
            if (weakness.trim() && problems.trim() && time.trim()) {
                const index = recommendations.findIndex(r => r.id === id);
                if (index !== -1) {
                    recommendations[index].weakness = weakness.trim();
                    recommendations[index].problems = problems.trim();
                    recommendations[index].difficulty = difficulty;
                    recommendations[index].time = time.trim();
                    recommendations[index].status = status;
                }
            }
            
            editingRecommendationId = null;
            renderRecommendationTable();
        }
        
        // 取消编辑练习建议
        function cancelEditRecommendation() {
            editingRecommendationId = null;
            renderRecommendationTable();
        }
        
        // 删除练习建议
        function deleteRecommendation(id) {
            if (confirm("确定要删除这个练习建议吗？")) {
                recommendations = recommendations.filter(r => r.id !== id);
                renderRecommendationTable();
            }
        }
        
        // 删除弱项
        function deleteWeakness(id) {
            if (confirm("确定要删除这个弱项记录吗？")) {
                weaknesses = weaknesses.filter(item => item.id !== id);
                renderTables();
            }
        }
        
        // 删除做题记录
        function deleteRecord(id) {
            if (confirm("确定要删除这个做题记录吗？")) {
                records = records.filter(item => item.id !== id);
                renderTables();
            }
        }
        
        // 事件监听
        addWeaknessBtn.addEventListener('click', () => {
            weaknessModal.style.display = 'flex';
        });
        
        addRecordBtn.addEventListener('click', () => {
            recordModal.style.display = 'flex';
            // 设置默认日期为今天
            document.getElementById('record-date').valueAsDate = new Date();
        });
        
        addRecommendationBtn.addEventListener('click', () => {
            recommendationModal.style.display = 'flex';
        });
        
        editFocusBtn.addEventListener('click', () => {
            // 如果当前没有在编辑状态，则添加一个新的本周重点
            if (editingFocusId === null) {
                const newFocus = prompt("请输入本周重点内容：");
                if (newFocus && newFocus.trim()) {
                    addFocus(newFocus.trim());
                }
            }
        });
        
        closeWeakness.addEventListener('click', () => {
            weaknessModal.style.display = 'none';
        });
        
        closeRecord.addEventListener('click', () => {
            recordModal.style.display = 'none';
        });
        
        closeRecommendation.addEventListener('click', () => {
            recommendationModal.style.display = 'none';
        });
        
        cancelExportBtn.addEventListener('click', cancelExport);
        
        // 导出按钮事件
        exportPdfBtn.addEventListener('click', (e) => {
            e.preventDefault();
            exportToPDF();
        });
        
        exportPngBtn.addEventListener('click', (e) => {
            e.preventDefault();
            exportToImage('png');
        });
        
        exportJpgBtn.addEventListener('click', (e) => {
            e.preventDefault();
            exportToImage('jpg');
        });
        
        // 点击模态框外部关闭
        window.addEventListener('click', (e) => {
            if (e.target === weaknessModal) {
                weaknessModal.style.display = 'none';
            }
            if (e.target === recordModal) {
                recordModal.style.display = 'none';
            }
            if (e.target === recommendationModal) {
                recommendationModal.style.display = 'none';
            }
        });
        
        // 弱项表单提交
        weaknessForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const category = document.getElementById('weakness-category').value;
            const content = document.getElementById('weakness-content').value;
            const difficulty = document.getElementById('weakness-difficulty').value;
            const mastery = document.getElementById('weakness-mastery').value;
            const notes = document.getElementById('weakness-notes').value;
            
            addWeakness(category, content, difficulty, mastery, notes);
            weaknessModal.style.display = 'none';
            weaknessForm.reset();
            masteryValue.textContent = '30%';
            masterySlider.value = 30;
        });
        
        // 做题记录表单提交
        recordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('record-title').value;
            const category = document.getElementById('record-category').value;
            const date = document.getElementById('record-date').value;
            const time = document.getElementById('record-time').value;
            const difficulty = document.getElementById('record-difficulty').value;
            const rating = document.getElementById('record-rating').value;
            const notes = document.getElementById('record-notes').value;
            
            addRecord(title, category, date, time, difficulty, rating, notes);
            recordModal.style.display = 'none';
            recordForm.reset();
        });
        
        // 练习建议表单提交
        recommendationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const weakness = document.getElementById('recommendation-weakness').value;
            const problems = document.getElementById('recommendation-problems').value;
            const difficulty = document.getElementById('recommendation-difficulty').value;
            const time = document.getElementById('recommendation-time').value;
            const status = document.getElementById('recommendation-status').value;
            const notes = document.getElementById('recommendation-notes').value;
            
            addRecommendation(weakness, problems, difficulty, time, status, notes);
            recommendationModal.style.display = 'none';
            recommendationForm.reset();
        });
        
        // 掌握程度滑块实时显示
        masterySlider.addEventListener('input', () => {
            masteryValue.textContent = masterySlider.value + '%';
        });
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            renderTables();
            // 设置默认日期为今天
            document.getElementById('record-date').valueAsDate = new Date();
        });
    </script>
</body>
</html>
